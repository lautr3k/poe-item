{"version":3,"file":"poe-item.mjs","sources":["../src/i18n.js","../src/template.js","../src/ItemBlockBase.js","../src/ItemBlockLine.js","../src/ItemBlock.js","../src/ItemBlocks.js","../src/Item.js","../src/ItemParserBase.js","../src/ItemParser.js"],"sourcesContent":["import template from \"./template\";\r\nimport dotProp from \"dot-prop\";\r\n\r\nexport default class I18n {\r\n  constructor() {\r\n    this.locales = {};\r\n    this.locale = null;\r\n  }\r\n\r\n  getLocale() {\r\n    return this.locale;\r\n  }\r\n\r\n  setLocale(locale) {\r\n    this.locale = locale;\r\n  }\r\n\r\n  get(path, defaultValue = null) {\r\n    dotProp.get(this.locales, path, defaultValue);\r\n  }\r\n\r\n  set(path, value) {\r\n    dotProp.set(this.locales, path, value);\r\n  }\r\n\r\n  has(path) {\r\n    return dotProp.has(this.locales, path);\r\n  }\r\n\r\n  delete(path) {\r\n    dotProp.delete(this.locales, path);\r\n  }\r\n\r\n  localeKey(path, locale = null) {\r\n    return `${locale || this.locale}.${path}`;\r\n  }\r\n\r\n  __(path, args = {}) {\r\n    const localKey = this.localeKey(path);\r\n    return template(dotProp.get(this.locales, localKey, localKey), args);\r\n  }\r\n}\r\n\r\nconst i18n = new I18n();\r\nconst __ = (...args) => i18n.__(...args);\r\n\r\nexport { I18n, i18n, __ };\r\n","export default function template(text, args) {\r\n  let tag, value;\r\n\r\n  Object.keys(args).forEach(arg => {\r\n    tag = `{{${arg}}}`;\r\n    value = args[arg] || tag;\r\n    text = text.replace(tag, value);\r\n  });\r\n\r\n  return text;\r\n}\r\n","import { __ } from \"./i18n\";\r\n\r\nexport default class ItemBlockBase {\r\n  constructor(raw) {\r\n    this.raw = (raw || \"\").trim();\r\n  }\r\n\r\n  match(pattern, flags = \"gmi\") {\r\n    return this.raw.match(new RegExp(pattern, flags)) || null;\r\n  }\r\n\r\n  matchLine(pattern, flags = \"gmi\") {\r\n    return this.match(`^${pattern}$`, flags);\r\n  }\r\n\r\n  matchAll(pattern, flags = \"gmi\") {\r\n    const matches = this.raw.matchAll(new RegExp(pattern, flags));\r\n    return matches ? [...matches] : null;\r\n  }\r\n\r\n  prop(usLabel) {\r\n    const label = __(usLabel);\r\n    const pattern = `${label} *([^:]+)?: *(.+)`;\r\n    const matches = this.matchLine(pattern, \"mi\");\r\n\r\n    if (!matches) {\r\n      return null;\r\n    }\r\n\r\n    return { label, usLabel, labelExtra: matches[1], value: matches[2] };\r\n  }\r\n\r\n  toString() {\r\n    return this.raw;\r\n  }\r\n}\r\n","import ItemBlockBase from \"./ItemBlockBase\";\r\n\r\nexport default class ItemBlockLine extends ItemBlockBase {}\r\n","import ItemBlockBase from \"./ItemBlockBase\";\r\nimport ItemBlockLine from \"./ItemBlockLine\";\r\n\r\nexport default class ItemBlock extends ItemBlockBase {\r\n  constructor(raw) {\r\n    super(raw);\r\n    this.lines = this.raw.split(/\\r?\\n/).map(line => new ItemBlockLine(line));\r\n  }\r\n\r\n  line(num) {\r\n    return this.lines[num - 1] || new ItemBlockLine();\r\n  }\r\n}\r\n","import ItemBlockBase from \"./ItemBlockBase\";\r\nimport ItemBlock from \"./ItemBlock\";\r\n\r\nexport default class ItemBlocks extends ItemBlockBase {\r\n  constructor(raw) {\r\n    super(raw);\r\n    this.blocks = this.raw\r\n      .split(/\\r?\\n--------\\r?\\n/)\r\n      .map(block => new ItemBlock(block));\r\n  }\r\n\r\n  block(block) {\r\n    return this.blocks[block - 1] || new ItemBlock();\r\n  }\r\n}\r\n","export default class Item {}\r\n","import { i18n, __ } from \"./i18n\";\r\nimport ItemBlocks from \"./ItemBlocks\";\r\nimport Item from \"./Item\";\r\n\r\nimport us from \"../locales/us.json\";\r\nimport fr from \"../locales/fr.json\";\r\n\r\ni18n.set(\"us\", us);\r\ni18n.set(\"fr\", fr);\r\n\r\nexport default class ItemParserBase {\r\n  constructor() {\r\n    this.__ = __;\r\n    this.i18n = i18n;\r\n    this.modules = {};\r\n    this.modulesQueue = [];\r\n    this.modulesDone = [];\r\n    this.blocks = null;\r\n    this.item = null;\r\n    this.setup(\"\");\r\n    this.init();\r\n  }\r\n\r\n  init() {\r\n    throw new Error(\"You have to implement the method!\");\r\n  }\r\n\r\n  parse() {\r\n    throw new Error(\"You have to implement the method!\");\r\n  }\r\n\r\n  setup(raw) {\r\n    this.blocks = new ItemBlocks(raw);\r\n    this.item = new Item();\r\n    this.modulesDone = [];\r\n  }\r\n\r\n  bindModule(name, callback) {\r\n    this.modulesQueue.push(name);\r\n    this.modules[name] = callback.bind(this);\r\n  }\r\n\r\n  runModule(name) {\r\n    if (this.modulesDone.includes(name)) {\r\n      throw new Error(`A module can only be run once: ${name})`);\r\n    }\r\n\r\n    this.modulesDone.push(name);\r\n    this.modules[name]();\r\n  }\r\n\r\n  runAllModules() {\r\n    this.modulesQueue.forEach(name => this.runModule(name));\r\n  }\r\n\r\n  // unableToFindItemProp(propName) {\r\n  //   throw new Error(\r\n  //     i18n.__('Unable to find item \"{{propName}}\".', {\r\n  //       propName: i18n.__(propName)\r\n  //     })\r\n  //   );\r\n  // }\r\n}\r\n","import ItemParserBase from \"./ItemParserBase\";\r\n\r\nexport default class ItemParser extends ItemParserBase {\r\n  init() {\r\n    console.log(\"init...\");\r\n  }\r\n\r\n  parse(raw) {\r\n    this.setup(raw);\r\n    this.runAllModules();\r\n    console.log(this.blocks.prop(\"Rarity\"));\r\n    return this.item;\r\n  }\r\n}\r\n"],"names":["I18n","constructor","locales","locale","getLocale","this","setLocale","get","path","defaultValue","dotProp","set","value","has","delete","localeKey","__","args","localKey","text","tag","Object","keys","forEach","arg","replace","template","i18n","ItemBlockBase","raw","trim","match","pattern","flags","RegExp","matchLine","matchAll","matches","prop","usLabel","label","labelExtra","toString","ItemBlockLine","ItemBlock","lines","split","map","line","num","ItemBlocks","blocks","block","Item","ItemParserBase","modules","modulesQueue","modulesDone","item","setup","init","Error","parse","bindModule","name","callback","push","bind","runModule","includes","runAllModules","ItemParser","console","log"],"mappings":"wBAGe,IAAMA,EACnBC,gBACOC,QAAU,QACVC,OAAS,kBAGhBC,4BACSC,KAAKF,oBAGdG,mBAAUH,QACHA,OAASA,eAGhBI,aAAIC,EAAMC,kBAAe,MACvBC,EAAQH,IAAIF,KAAKH,QAASM,EAAMC,gBAGlCE,aAAIH,EAAMI,GACRF,EAAQC,IAAIN,KAAKH,QAASM,EAAMI,gBAGlCC,aAAIL,UACKE,EAAQG,IAAIR,KAAKH,QAASM,gBAGnCM,gBAAON,GACLE,EAAQI,OAAOT,KAAKH,QAASM,gBAG/BO,mBAAUP,EAAML,yBAAS,OACbA,GAAUE,KAAKF,YAAUK,eAGrCQ,YAAGR,EAAMS,kBAAO,QACRC,EAAWb,KAAKU,UAAUP,UCtCrB,SAAkBW,EAAMF,OACjCG,SAEJC,OAAOC,KAAKL,GAAMM,iBAAQC,GAGxBL,EAAOA,EAAKM,QAFZL,EAAO,KAAII,OACHP,EAAKO,IAAQJ,KAIhBD,ED8BEO,CAAShB,EAAQH,IAAIF,KAAKH,QAASgB,EAAUA,GAAWD,QAI7DU,EAAO,IAAI3B,EACXgB,2EAAkBW,EAAKX,WAAMC,IE1CdW,EACnB3B,SAAY4B,QACLA,KAAOA,GAAO,IAAIC,oBAGzBC,eAAMC,EAASC,yBAAQ,OACd5B,KAAKwB,IAAIE,MAAM,IAAIG,OAAOF,EAASC,KAAW,kBAGvDE,mBAAUH,EAASC,yBAAQ,OAClB5B,KAAK0B,UAAUC,MAAYC,gBAGpCG,kBAASJ,EAASC,kBAAQ,WAClBI,EAAUhC,KAAKwB,IAAIO,SAAS,IAAIF,OAAOF,EAASC,WAC/CI,EAAU,UAAIA,GAAW,kBAGlCC,cAAKC,OACGC,EAAQxB,EAAGuB,GAEXF,EAAUhC,KAAK8B,UADFK,sBACqB,aAEnCH,EAIE,OAAEG,UAAOD,EAASE,WAAYJ,EAAQ,GAAIzB,MAAOyB,EAAQ,IAHvD,kBAMXK,2BACSrC,KAAKwB,KC/BD,IAAMc,0IAAsBf,GCCtBgB,cACnB3C,WAAY4B,eACJA,QACDgB,MAAQxC,KAAKwB,IAAIiB,MAAM,SAASC,aAAIC,UAAQ,IAAIL,EAAcK,qGAGrEA,cAAKC,UACI5C,KAAKwC,MAAMI,EAAM,IAAM,IAAIN,MAPCf,GCAlBsB,cACnBjD,WAAY4B,eACJA,QACDsB,OAAS9C,KAAKwB,IAChBiB,MAAM,sBACNC,aAAIK,UAAS,IAAIR,EAAUQ,qGAGhCA,eAAMA,UACG/C,KAAK8C,OAAOC,EAAQ,IAAM,IAAIR,MATDhB,GCHnByB,eCOrB1B,EAAKhB,IAAI,wBACTgB,EAAKhB,IAAI,wBAEM,IAAM2C,EACnBrD,gBACOe,GAAKA,OACLW,KAAOA,OACP4B,QAAU,QACVC,aAAe,QACfC,YAAc,QACdN,OAAS,UACTO,KAAO,UACPC,MAAM,SACNC,oBAGPA,sBACQ,IAAIC,MAAM,kDAGlBC,uBACQ,IAAID,MAAM,kDAGlBF,eAAM9B,QACCsB,OAAS,IAAID,EAAWrB,QACxB6B,KAAO,IAAIL,OACXI,YAAc,gBAGrBM,oBAAWC,EAAMC,QACVT,aAAaU,KAAKF,QAClBT,QAAQS,GAAQC,EAASE,KAAK9D,mBAGrC+D,mBAAUJ,MACJ3D,KAAKoD,YAAYY,SAASL,SACtB,IAAIH,wCAAwCG,YAG/CP,YAAYS,KAAKF,QACjBT,QAAQS,kBAGfM,yCACOd,aAAajC,iBAAQyC,UAAQ3D,EAAK+D,UAAUJ,MClDtC,IAAMO,mJACnBX,gBACEY,QAAQC,IAAI,wBAGdX,eAAMjC,eACC8B,MAAM9B,QACNyC,gBACLE,QAAQC,IAAIpE,KAAK8C,OAAOb,KAAK,WACtBjC,KAAKqD,SATwBJ"}